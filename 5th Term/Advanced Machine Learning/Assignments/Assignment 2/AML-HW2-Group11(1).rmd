---
title: "Assignment 2"
subtitle: "Group 11"
author: "Chang Zhou 01983512, Qian Zhang 01939418, Yutong Zheng 01895402"
date: "2021/5/17"
output:
  pdf_document: default
  html_document: default
---
```{r include=FALSE}
library(dplyr)
library(stargazer)
library(ggplot2)
```

![](1.jpeg)

![](2.png)

# Question 2
(a)
The proportion of parked cars in violation of the meters in the population is approximated by the number of "violation" cars in randomly selected blocks divided by the total number of parking cars in those blocks. 

(b)
If we can assume all the parking cars are i.i.d. samples, or differences between blocks are really small and all cars are parking at random among all blocks, then we can regard them as Bernoulli trials with true $p$. Therefore $\frac{\sum_{i=1}^{n}x_i}{\sum_{i=1}^{n}z_i}$ is a reasonable estimate of $p$ when simple random sampling is inefficient and expensive.

(c)
The usual formula may not be appropriate under this situation since the variance of $\tilde{p}$ in this formula is only useful for Bernoulli trials when all parking cars have the same distribution and independently distributed. However, by picking blocks randomly, we may encounter differences between blocks (maybe some blocks have stricter rules for violation) and it will bring us the variance among all blocks. \newline

(d)
$\tilde{p}$ is not an unbiased estimator for $p$. For example, there are 3 blocks in a city and the number of cars parked are 10, 8, 4 and the number of cars in violation of the meters are 10, 4, 0 respectively. We randomly select 2 blocks to estimate $p$. If we sample 1st and 2nd block, $\tilde{p}=7/9$, 1st and 3rd: $\tilde{p}=5/7$, 2nd and 3rd: $\tilde{p}=1/3$. Then E($\tilde{p}$) is estimated by $(7/9+5/7+1/3)/3=115/189$, and $p$ is estimated by $\frac{10+4}{10+8+4}=7/11$. It's obvious that E($\tilde{p}$) is not equal to $p$.\newline
Actually the unbiased estimator for $p$ is $\hat{p}=\frac{N}{M}\frac{1}{n}\sum_{i=1}^{n}x_i$. Suppose N is the number of blocks in the population, n is the number of blocks selected, M is the number of cars ($\sum_{i=1}^{N}z_i=M$) and $\bar{M}=M/N$. Then an unbiased estimator for Var($\tilde{p}$) is $\frac{1}{M^2}N(N-n)\frac{1}{n}\hat{\sigma_b}^2$, where $\hat{\sigma_b}^2$ is the estimator for population variance of block totals and $\hat{\sigma_b}^2=\frac{1}{n-1}\sum_{i=1}^{n}(z_i\hat{p_i}-\bar{M}\hat{p})^2$.

# Question3
```{r}
samples <- matrix(c(4,12,3,8,3,9,3,16,2,7,4,15,4,10,3,15,2,6,1,12,3,8,2,14), ncol = 2, byrow = T)
df <- data.frame(samples)
#first we input the data as a object with x1=xi,x2=zi for next calculations.
```


# a
```{r}
alpha_hat <- t(apply(df, 2, sum)[1]/apply(df, 2, sum)[2]) # 0.2575758
# we sum the x1 and x2 separately and divide x1 by x2.
```

#b
Since in this problem, we do not know the specific sample distribution, and it is difficult to collect all the data at the same time.

#c
it get the data from a empirical distribution sample and get the true distribution,

# d
```{r}
list1 <- c()
set.seed(1)#set seed in case to change the list every time 
for (i in 1:1000){
  df1 <- df[sample(nrow(df), 12, replace = T), ]
  #Re extract 12 data for each list with 1000 times to form bootstrap samples
  p <- t(apply(df1, 2, sum)[1]/apply(df1, 2, sum)[2])
  #calculate each p-hat 
  list1 <- c(list1, p)
  #save 1000 p-hat as a list
}
alpha_b <- mean(list1) 
#get the 1000 p-hat mean as 0.25792
```



# e
```{r}
library(Rmisc)
CI(list1,ci=0.95)
```



# f
```{r}
df2 <- data.frame(list1)
library(ggplot2)

ggplot(df2, aes(x = list1)) +
  geom_histogram(colour="blue") + labs(x = 'p' , y = 'count') + 
  scale_y_continuous(limits=c(0, 100)) + 
  geom_vline(xintercept=alpha_b, color = "red", size = 1, linetype="dashed")
```
Because the data shows a normal distribution trend, the data outside the confidence interval is a small probability event by default and will not occur.